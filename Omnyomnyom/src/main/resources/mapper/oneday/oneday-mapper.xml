<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="oneday">

<select id="selectReservationList" resultType="reservation">
	select
		*
	from
		tb_reservation 
	<where>
		<if test="memberId != null AND memberId = ''">
		member_id = #{memberId}
		</if>
	</where>
	order by 
		reservation_no desc
</select>

<select id="selectOnedayReviewList" resultType="onedayReview">
	select
		*
	from
		tb_oneday_review 
	order by 
		review_no desc
</select>
<insert id="insertOneday">
	insert into 
	tb_onedayclass 
		values (
				seq_oneday_class.nextval,
				#{memberId},
				#{onedayName},
				#{onedayPrice},
				#{onedayContent},
				#{latitude},
				#{longitude},
				#{detailedAddr},
				#{onedayTime},
				#{onedayMaxper},
				#{onedayMinper},
				#{onedayImg},
				<!-- gson 배열로 받음 -->
				#{menuList}
			)
			<selectKey keyProperty="onedayclassNo" resultType="_int" order="AFTER">
				select seq_oneday_class.currval from dual
			</selectKey>			
</insert>

<insert id="insertTime">
	insert into
		tb_onedayclasstime
			values(
				seq_oneday_time.nextval,
				#{onedayNoo},
				#{onedayTimeDate}
			)
</insert>

<select id="selectDateList"  resultType="Oneday">

<!-- select * from tb_onedayclass -->
	
select * from 
(select * from
tb_onedayclasstime oct
left join
TB_onedayclass oc on oct.onedayclass_no = oc.onedayclass_no
<where>
	<if test="detailedAddr != null">
		and detailed_addr like #{detailedAddr}
	</if>
	<if test="onedayName != null">
		and oneday_name like #{onedayName}
	</if>

	<if test="onedayTimeList != null">	
	<foreach collection="onedayTimedate" item="item">
		or onedayTime_date like #{item}
	</foreach>
	</if>

</where>)
<!-- <where>	
<if test="onedayTimeList != null">	
	<foreach collection="onedayTimedate" item="item">
		and onedayTime_date like #{item}
	</foreach>
	</if>
</where> -->
		
</select>


<select id="selectTimeList" resultMap="timeCollection">
	select*from tb_onedayclasstime
</select>



<select id="selectTimeOne" resultMap="timeCollection">
	select * from tb_onedayclasstime
	where onedayclass_no = #{onedayclassNo}
</select>


<resultMap type="OnedayTime" id="timeCollection">
	<result column="onedayclass_no" property="onedayNoo"/>
	

</resultMap>


</mapper>